<html>

<head>
	<title>todo</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<style type="text/css">
		body {
			font-size: 18pt;
			font-family: Tahoma, Verdana, Arial;
		}

		#main {
			margin: 12px;
		}

		#new-todo {
			height: 32px;
			line-height: 28px;
			font-family: Tahoma, Verdana, Arial;
			width: 240px;
		}

		a {
			text-decoration: none !important;
		}

		a.del {
			display: inline-block;
			width: 42px;
			text-align: center;
			margin-left: -120px;
			color: #ccc;
		}

		a.del:hover {
			display: inline-block;
			color: White;
			background-color: Red;
		}

		a.btn-common {
			color: #c0c0c0;
			margin-bottom: 12px;
			display: inline-block;
		}

		a.btn-common:hover {
			color: Gray;
		}

		a.btn-check-list {
			color: Grey;
			display: inline-block;
            cursor: -moz-grab;
		}

        a.btn-check span { 
            display: inline-block;
            cursor: -moz-grab;
        }

		.counter {
			color: Green;
			display: inline-block;
			margin-right: 200px;
            cursor: -moz-grab;
		}

        input[type=checkbox]:checked {
            content: "\2713";
            text-shadow: 1px 1px 1px rgba(0, 0, 0, .2);
            font-size: 15px;
            color: #f3f3f3;
            text-align: center;
            line-height: 15px;
        }

		/* li {
            display: inline-block;
        }  */


        /* ol li {
            display: inline-block;
        } 
s
        ul li {
            display: inline-block;
        } */

		li.task {
			display: inline-block;
			cursor: default;
			margin-left: 80px;
		}

		li.task span {
			margin-left: 64px;
		}

		#list-ready li.task {
			list-style-type: circle;
            font-style: oblique;
			opacity: 0.5;
			color: Gray;
		}

		#list-ready li.task span {
			text-decoration: line-through;
		}

        /* <!-- ////////////// --> */
        /* Pagination */
        .pagination {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  padding-left: 0;
  list-style: none;
  border-radius: 0.25rem;
}

.page-link {
  position: relative;
  display: block;
  padding: 0.5rem 0.75rem;
  margin-left: -1px;
  line-height: 1.25;
  color: #2AA198;
  background-color: transparent;
  border: 1px solid #073642;
}

.page-link:hover {
  z-index: 2;
  color: #2AA198;
  text-decoration: none;
  background-color: #073642;
  border-color: #073642;
}

.page-link:focus {
  z-index: 2;
  outline: 0;
  -webkit-box-shadow: 0 0 0 0.2rem rgba(7, 54, 66, 0.25);
          box-shadow: 0 0 0 0.2rem rgba(7, 54, 66, 0.25);
}

.page-item:first-child .page-link {
  margin-left: 0;
  border-top-left-radius: 0.25rem;
  border-bottom-left-radius: 0.25rem;
}

.page-item:last-child .page-link {
  margin-right: 0;
  border-top-right-radius: 0.25rem;
  border-bottom-right-radius: 0.25rem;
}

.page-item.active .page-link {
  z-index: 1;
  color: rgba(255, 255, 255, 0.75);
  background-color: #073642;
  border-color: #073642;
}

.page-item.disabled .page-link {
  color: #073642;
  pointer-events: none;
  cursor: auto;
  background-color: transparent;
  border-color: #073642;
}


	</style>
	<script type="text/javascript" src="http://code.jquery.com/jquery-3.3.1.js"></script>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.12/jquery-ui.min.js"></script>
	<script type="text/javascript" async>


		function saveState() {

			let notReady = [];
			let ready = [];

			$('#list-not-ready li.task span').each(function (i, el) {
				let val = encodeURI($(el).text());
				notReady.push(val);
			});

			$('#list-ready li.task span').each(function (i, el) {
				let val = encodeURI($(el).text());
				ready.push(val);
			});

			let result = notReady.join('&') + '|' + ready.join('&');

			let time = new Date();
			time.setTime(time.getTime() + 2678400000);
			document.cookie = "data=" + result + "; path=/ " + "; expires=" + time.toGMTString();
			console.log( document.cookie = "data=" + result + "; path=/ " + "; expires=" + time.toGMTString())
		}

		function loadState() {

			let addList = function (strList, isComplete) {

				let list = strList.split('&');
				console.log(list);

				for (let i = 0; i < list.length; i++) {
					if (list[i]) {
						addTask(decodeURI(list[i]), isComplete);
					}
				}
			}


			var getCookie = function (name) {
				let cSIndex = document.cookie.indexOf(name);
				if (cSIndex == -1) {
					return ''
				};

				cSIndex = document.cookie.indexOf(name + "=")
				if (cSIndex == -1) {
					return ''
				};

				let cEIndex = document.cookie.indexOf(";", cSIndex + (name + "=").length);
				if (cEIndex == -1) {
					cEIndex = document.cookie.length;
				}

				return document.cookie.substring(cSIndex + (name + "=").length, cEIndex);
			}

			var parts = getCookie('data').split('|');

			console.log("Загрузка сосотояния ");


            let removeList = function(isComplete) {

                let container = isComplete ? '#list-ready' : '#list-not-ready';
                let taskList = $(container).find('.task');

                console.log(taskList);
                taskList.each( (i, task) => $(task).remove());
            }

			if (parts[0] != "") {
				addList(parts[0], false);
			    $("#counter-not-ready-value").text((parts[0].split('&')).length);
			}
			if (parts.length > 1) {
				if (parts[1] != "") {
					addList(parts[1], true);
				    $("#counter-ready-value").text((parts[1].split('&')).length);
				}		
		 	}
		
		}

		function moveTask(li, isComplete) {
			let container = isComplete ? '#list-ready' : '#list-not-ready';

			li.appendTo(container);
			saveState();
		}


		function changeCounter(li, changeValue) {
			
            let list = li.parent('.list');
            console.log(li.parent('.list'));

            let counter;
            if(list.attr('id') == 'list-ready') counter = $("#counter-ready-value");
			if(list.attr('id') == 'list-not-ready') counter = $("#counter-not-ready-value");
 

            console.log(counter);
			let value = +escape($(counter).text());
			console.log(value);

			if(value + changeValue > 0) $(counter).text((value + changeValue));
			else $(counter).text("0");

			setAllCounter();
		}

        function setAllCounter() {
			let readyCounterValue = +$("#counter-ready-value").text();
			let notReadyCounterValue = +$("#counter-not-ready-value").text();
			let allCounter = $("#counter-all-value");

			allCounter.text((readyCounterValue + notReadyCounterValue));

		}
      

		function addTask(val, isComplete) {

			let span = $('<span contenteditable="true" />').text(val);
			let cb = $('<input type="checkbox" class="sbtn-check" />');
			let del = $('<a class="del" href="#" />').text('×');
			let li = $('<li class="task" data-showed="true"/>').append(del).append(cb).append(span);  //

			cb.click(function () {

				changeCounter(li, -1);

				moveTask(li, cb.prop('checked'));
				changeCounter(li, 1);


				checkPagPageCount();

			}).prop('checked', isComplete);

			del.click(function () {
				
				// if(li.parent('.list').attr("id") != 'list-ready') changeCounter(li, -1);
                changeCounter(li, -1);
				
				li.remove();
               

				saveState();
				checkPagPageCount();
				return false;
			});

			moveTask(li, isComplete);
			return li;

		}

        function addPagPage(isActive) {

            let pagContainer = $('.pagination'); 

            let pageNumber = pagContainer.find('li').length+ 1;

            console.log(pagContainer.find('li'));
            console.log(pagContainer);


            let page = $('<a class="page-link" href="#"></a>');
            page.text(pageNumber);
            let li_pag =  isActive ? $('<li class="page-item active" />').append(page) : $('<li class="page-item" />').append(page);


            li_pag.appendTo(pagContainer);

			li_pag.click(function() {

				console.log($('.page-item, active'));
				$('.page-item, active').removeClass('page-item active').addClass('page-item');
				li_pag.removeClass('page-item').addClass('page-item active');

				// Функция обновления списка для отображения нужных элементов
				getTasksForPagPage(pageNumber);

			});

        }

        function getTasksForPagPage(pageNumber)  ///
		{
			let elementsOnPageCount = +$('#screen-elements-count-value').text();


            let startNumber = (pageNumber-1)*elementsOnPageCount; 
			let endNumber = pageNumber*elementsOnPageCount - 1;


			let showedCheckedTasks = $('.task').filter('[data-showed = true]');
			let showedTasksCount = showedCheckedTasks.length;

			showedCheckedTasks.each((i, el) => {
				if (i >= startNumber && i <= endNumber) $(el).css('display', 'inline-block');
				else $(el).css('display', 'none');
			});


            console.log(elementsOnPageCount, pageNumber, showedTasksCount);
			console.log(showedCheckedTasks.filter('[display = inline-block]').length);
 
            let numberOfAdditionalPages = Math.ceil(showedTasksCount/elementsOnPageCount) - pageNumber;
            console.log(numberOfAdditionalPages);
		}


		function changePagPageCount(numberOfAdditionalPages) {
			for (let i=0; i < Math.abs(numberOfAdditionalPages); i++) {
				if (numberOfAdditionalPages >= 0) addPagPage(false);
				if (numberOfAdditionalPages < 0) removePagPage();
			}
		}


        function removePagPage() {
            let pagContainer = $('.pagination');

			console.log(pagContainer);
            if (pagContainer.find('li').length > 1 ) pagContainer.find('li').last().remove();
        }

		function checkPagPageCount() {
			let elementsOnPageCount = +$('#screen-elements-count-value').text();

            console.log($('.pagination'));

			let pagPageCount =  $('.pagination').find('li').length;
			// let showedTasksCount = +$('ol > .task').length + $('ul > .task').length;
			let showedTasksCount = +$('.task').filter('[data-showed = true]').length;


			console.log(elementsOnPageCount, pagPageCount, showedTasksCount);

			let numberOfAdditionalPages = Math.ceil(showedTasksCount/elementsOnPageCount) - pagPageCount;
			console.log(numberOfAdditionalPages);

			changePagPageCount(numberOfAdditionalPages);
			getTasksForPagPage(1);
		}



		$(function () {

			$('#btn-enter').click(function () {
				let val = $('#new-todo').val();
				if (val) {
					console.log(val);
					let li = addTask(val);
					changeCounter(li, 1);

					$('#new-todo').val('');
				}

				checkPagPageCount();
				return false;
			});

			$('#new-todo').keypress(function (e) {
				if (e.keyCode == 13) {
					$('#btn-enter').click();
				}
			});

			// $('#list-not-ready').sortable({ deactivate: saveState }); // после перетаскивания сохраняем состояние в куках

			$('#btn-remove-all').click(function () {			
				$('#list-ready').empty();
				$('#list-not-ready').empty();

				$("#counter-ready-value").text("0");
				$("#counter-not-ready-value").text("0");


				saveState();
				setAllCounter();
				return false;
			});

			$('#btn-remove-completed').click(function () {
				$('#list-ready').empty();

                $("#counter-ready-value").text("0");

				saveState();
				setAllCounter();
				checkPagPageCount();
				return false;
			});



			function IsDisplayed(IsChecked) {
				return IsChecked ? 'inline-block' : 'none';
			}


			$('.btn-check-list').click(function () {

				clickedCheckBox = $(this);
				console.log(this);
				let IsChecked = clickedCheckBox.prop('checked');
				console.log(clickedCheckBox.attr('id'));

				if (IsChecked == false) clickedCheckBox.prop('checked', true);
				else {
				    let otherCheckBoxes = $('.btn-check-list').filter((i, el) => $(el).attr('id') !== clickedCheckBox.attr('id'));
					console.log(otherCheckBoxes);

				    otherCheckBoxes.each( (i, el) => { $(el).prop('checked', false);})


    				if(clickedCheckBox.attr('id') == 'check-list-not-ready') {
	 					$("#list-ready").find("li").each( (i, el) => {
			    		el.setAttribute('data-showed', !IsChecked);
				        });			
					}
				   if(clickedCheckBox.attr('id') == 'check-list-ready'){
					    $("#list-not-ready").find("li").each( (i, el) => {
				        el.setAttribute('data-showed', !IsChecked);
				        });  			
					}
				    if(clickedCheckBox.attr('id') == 'check-list-all') {
					    otherCheckBoxes.each((i, el) => { 
					    	el.setAttribute('data-showed', true);
				        });
				    };
			    }

				checkPagPageCount();
				console.log(clickedCheckBox);
				console.log(IsChecked);

			});


			// $('#check-list-not-ready').click(function () {

			// 	let IsChecked = $('#check-list-not-ready').prop('checked');

            //     // $("#list-ready").css('display', IsDisplayed(!IsChecked));
			// 	$("#list-ready").find("li").each( (i, el) => {
			// 		$(el).css('display', IsDisplayed(!IsChecked));
			// 		el.setAttribute('data-showed', !IsChecked)
			// 		});  //

			// 	checkPagPageCount();
			// 	console.log("check-list-not-ready");
			// 	console.log(IsChecked);

			// });

			// $('#check-list-ready').click(function () {

			// 	let IsChecked = $('#check-list-ready').prop('checked');
				
            //     // $("#list-not-ready").css('display', IsDisplayed(!IsChecked));
			// 	$("#list-not-ready").find("li").each( (i, el) => {
			// 		$(el).css('display', IsDisplayed(!IsChecked));
			// 		el.setAttribute('data-showed', !IsChecked)
			// 		});  //

			// 	checkPagPageCount();
			// 	console.log("check-list-ready");
			// 	console.log(IsChecked);

			// });

			addPagPage(true);
			loadState();
			setAllCounter();
			$('#check-list-all').click();
			//checkPagPageCount();

		})



	</script>
	<script type="text/javascript">

		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-18125737-1']);
		_gaq.push(['_trackPageview']);

		(function () {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();

	</script>
</head>

<body>
	<div id="main">
		<a id="btn-remove-all" class="btn-common" href="#">Начать новый список</a>
		<div>
			<input id="new-todo" placeholder="Что нужно делать?" />
			<a id="btn-enter" class="btn-common" href="#">Enter</a>
		</div>
		<div>
			
			<input id="check-list-all" type="checkbox" class="btn-check-list" href="#">
			<!-- <input id="check-list-not-ready" class="check-list-not-ready__input"  type="checkbox" href="#">
			<label for="check-list-not-ready" class="check-list-not-ready__label">*</label> -->
			<a >Отобразить все</a>
			<span class="counter" value="0">       Всего  
				<span id="counter-all-value">0</span>
			</span> 
			</input>
	    </div>
		<div>

            <input id="check-list-not-ready" type="checkbox" class="btn-check-list" href="#">
			<a >Отобразить только незавершенные</a>
			<span class="counter" value="0">       Всего незавершенных 
				<span id="counter-not-ready-value">0</span>
			</span> 
		   </input>
		</div>
		<div>
			<input id="check-list-ready" type="checkbox" class="btn-check-list" href="#">
			<a >Отобразить только завершенные</a>
			<span class="counter" value="0">      Всего завершенных 
				<span id="counter-ready-value">0</span>
			</span> 
		    </input>
		</div>
		<div>
			<ol id="list-not-ready" class="list" >
			</ol>
		</div>
		<div>
			<ul id="list-ready" class="list" >
			</ul>
		</div>
		<a id="btn-remove-completed" class="btn-common" href="#">Удалить выполненные</a>
    </div>
    <div>
        <span class="screen-elements-count">Количество элементов на экране</span>
        <span id="screen-elements-count-value" contenteditable="true">5</span>
    </div>  
    <div> 
        <ul class="pagination pagination-sm">
        </ul>
    </div>
</body>

</html>